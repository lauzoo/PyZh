
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <title>14. (译)十分钟搞定pandas + 实例 &#8212; 一起写Python文章，一起看Python文章</title>
    <link rel="stylesheet" href="_static/rux.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="prev" title="13. Python Realtime" href="python-realtime.html" />
   
  <script type="text/javascript"
    src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  </head><body>
  
  


    <div class="document">
  <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body">
          <h1 class="project-name">
            <a href="index.html">PyZh</a>
          </h1>
          <div class="nav separator">
          <span>
            <a href="index.html">Index</a>&nbsp;~ <a href="https://github.com/hit9/PyZh">Code</a>&nbsp;
            ~ <a href="https://github.com/hit9/PyZh/issues">Issues</a>&nbsp;</span>
          </div>
          <p class="flourish"><img src="_static/flourish.svg" height="60px" alt=""></p>
          <div class="body-html">
            
  <div class="section" id="pandas">
<span id="python-pandas"></span><h1><a class="toc-backref" href="#id27"><span class="section-number">14. </span>(译)十分钟搞定pandas + 实例</a><a class="headerlink" href="#pandas" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">作者</dt>
<dd class="field-odd"><p>wzl</p>
</dd>
<dt class="field-even">日期</dt>
<dd class="field-even"><p>2017-04-06</p>
</dd>
<dt class="field-odd">注</dt>
<dd class="field-odd"><p>欢迎fork后pull request来丰富这个文章.</p>
</dd>
</dl>
<div class="contents topic" id="id1">
<p class="topic-title first">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pandas" id="id27">(译)十分钟搞定pandas + 实例</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id28">什么是pandas？</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id29">十分钟搞定pandas（译文+注释）</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id30">创建对象</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id31">查看数据</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id32">选择数据</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id33">缺失数据处理</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id34">相关操作</a></p></li>
<li><p><a class="reference internal" href="#id14" id="id35">合并</a></p></li>
<li><p><a class="reference internal" href="#id15" id="id36">分组</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id37">重塑</a></p></li>
<li><p><a class="reference internal" href="#id17" id="id38">时间序列</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id39">分类</a></p></li>
<li><p><a class="reference internal" href="#id20" id="id40">绘图</a></p></li>
<li><p><a class="reference internal" href="#id23" id="id41">获取数据 写入导出</a></p></li>
<li><p><a class="reference internal" href="#id25" id="id42">小陷阱</a></p></li>
<li><p><a class="reference internal" href="#id26" id="id43">pandas实战</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id28"><span class="section-number">14.1. </span>什么是pandas？</a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="https://github.com/pandas-dev/pandas">pandas</a> : Python数据分析模块</p>
<p>pandas是为了解决数据分析任务而创建的，纳入了大量的库和标准数据模型，提供了高效地操作大型数据集所需的工具。</p>
<p><code class="docutils literal notranslate"><span class="pre">pandas中的数据结构</span></code> :</p>
<ol class="arabic simple">
<li><p>Series: 一维数组，类似于python中的基本数据结构list，区别是series只允许存储相同的数据类型，这样可以更有效的使用内存，提高运算效率。就像数据库中的列数据。</p></li>
<li><p>DataFrame: 二维的表格型数据结构。很多功能与R中的data.frame类似。可以将DataFrame理解为Series的容器。</p></li>
<li><p>Panel：三维的数组，可以理解为DataFrame的容器。</p></li>
</ol>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id29"><span class="section-number">14.2. </span>十分钟搞定pandas（译文+注释）</a><a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">说明</span></code> : 本文是pandas官网 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/10min.html">10 Minutes to pandas</a> 的翻译。</p>
<p><code class="docutils literal notranslate"><span class="pre">引入需要的包</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code></p>
<ul class="simple">
<li><p>numpy 是一个python实现的科学计算包</p></li>
<li><p>matplotlib 是一个python的2D绘图库</p></li>
<li><p>更多章节请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/cookbook.html#cookbook">Cookbook</a></p></li>
</ul>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id30"><span class="section-number">14.3. </span>创建对象</a><a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#dsintro">数据结构介绍</a></p>
<p>1.通过传入一个列表来创建 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html#pandas.Series">Series</a> ，pandas会创建默认的整形指标:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">0  1</span>
<span class="go">1  3</span>
<span class="go">2  5</span>
<span class="go">3  NaN</span>
<span class="go">4  6</span>
<span class="go">5  8</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>2.通过传递数字数组、时间索引、列标签来创建 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html#pandas.DataFrame">DataFrame</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span>
<span class="go">    DatetimeIndex([&#39;2013-01-01&#39;, &#39;2013-01-02&#39;, &#39;2013-01-03&#39;, &#39;2013-01-04&#39;,</span>
<span class="go">                   &#39;2013-01-05&#39;, &#39;2013-01-06&#39;],</span>
<span class="go">                   dtype=&#39;datetime64[ns]&#39;, freq=&#39;D&#39;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-01  0.859619 -0.545903  0.012447  1.257684</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  1.468060</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442  1.694740</span>
<span class="go">    2013-01-06 -1.903683  0.786785 -0.194179  0.177973</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code></p>
<ul class="simple">
<li><p>np.random.randn(6,4) 即创建6行4列的随机数字数组</p></li>
</ul>
<p>3.通过传递能被转换成类似结构的字典来创建DataFrame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;df2 = pd.DataFrame({&#39;A&#39; : 1.,</span>
<span class="go">                       &#39;B&#39; : pd.Timestamp(&#39;20130102&#39;),</span>
<span class="go">                       &#39;C&#39; : pd.Series(1,index=list(range(4)),dtype=&#39;float32&#39;),</span>
<span class="go">                       &#39;D&#39; : np.array([3] * 4,dtype=&#39;int32&#39;),</span>
<span class="go">                       &#39;E&#39; : pd.Categorical([&quot;test&quot;,&quot;train&quot;,&quot;test&quot;,&quot;train&quot;]),</span>
<span class="go">                       &#39;F&#39; : &#39;foo&#39; })</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span>
<span class="go">       A          B  C  D      E    F</span>
<span class="go">    0  1 2013-01-02  1  3   test  foo</span>
<span class="go">    1  1 2013-01-02  1  3  train  foo</span>
<span class="go">    2  1 2013-01-02  1  3   test  foo</span>
<span class="go">    3  1 2013-01-02  1  3  train  foo</span>
</pre></div>
</div>
<p>4.查看各列的 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/basics.html#basics-dtypes">dtypes</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span><span class="o">.</span><span class="n">dtypes</span>
<span class="go">    A           float64</span>
<span class="go">    B    datetime64[ns]</span>
<span class="go">    C           float32</span>
<span class="go">    D             int32</span>
<span class="go">    E          category</span>
<span class="go">    F            object</span>
<span class="go">    dtype: object</span>
</pre></div>
</div>
<p>5.如果使用IPython，Tab会自动补全所有的属性和自定义的列，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="go">    df2.A                   df2.boxplot</span>
<span class="go">    df2.abs                 df2.C</span>
<span class="go">    df2.add                 df2.clip</span>
<span class="go">    df2.add_prefix          df2.clip_lower</span>
<span class="go">    df2.add_suffix          df2.clip_upper</span>
<span class="go">    df2.align               df2.columns</span>
<span class="go">    df2.all                 df2.combine</span>
<span class="go">    df2.any                 df2.combineAdd</span>
<span class="go">    df2.append              df2.combine_first</span>
<span class="go">    df2.apply               df2.combineMult</span>
<span class="go">    df2.applymap            df2.compound</span>
<span class="go">    df2.as_blocks           df2.consolidate</span>
<span class="go">    df2.asfreq              df2.convert_objects</span>
<span class="go">    df2.as_matrix           df2.copy</span>
<span class="go">    df2.astype              df2.corr</span>
<span class="go">    df2.at                  df2.corrwith</span>
<span class="go">    df2.at_time             df2.count</span>
<span class="go">    df2.axes                df2.cov</span>
<span class="go">    df2.B                   df2.cummax</span>
<span class="go">    df2.between_time        df2.cummin</span>
<span class="go">    df2.bfill               df2.cumprod</span>
<span class="go">    df2.blocks              df2.cumsum</span>
<span class="go">    df2.bool                df2.D</span>

<span class="go">可以看到，A、B、C、D列均通过Tab自动生成</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id31"><span class="section-number">14.4. </span>查看数据</a><a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/basics.html#basics">基本功能</a></p>
<p>1.查看DataFrame头部&amp;尾部数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-01  0.859619 -0.545903  0.012447  1.257684</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  1.468060</span>
<span class="go">    013-01-05 -0.300317 -0.011320 -1.376442  1.694740</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  1.468060</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442  1.694740</span>
<span class="go">    2013-01-06 -1.903683  0.786785 -0.194179  0.177973</span>
</pre></div>
</div>
<p>2.查看索引、列、和数组数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="go">    DatetimeIndex([&#39;2013-01-01&#39;, &#39;2013-01-02&#39;, &#39;2013-01-03&#39;, &#39;2013-01-04&#39;,</span>
<span class="go">                   &#39;2013-01-05&#39;, &#39;2013-01-06&#39;],</span>
<span class="go">                    dtype=&#39;datetime64[ns]&#39;, freq=&#39;D&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="go">    Index([u&#39;A&#39;, u&#39;B&#39;, u&#39;C&#39;, u&#39;D&#39;], dtype=&#39;object&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">values</span>
<span class="go">    array([[ 0.85961861, -0.54590304,  0.01244705,  1.25768432],</span>
<span class="go">    [ 0.11962178, -0.4840508 ,  0.40472795,  0.36088029],</span>
<span class="go">    [-0.7192337 , -0.39617432,  0.63523701,  0.21669124],</span>
<span class="go">    [-0.92169244,  0.87669275, -0.67055318,  1.46806034],</span>
<span class="go">    [-0.30031679, -0.01132035, -1.37644224,  1.69474031],</span>
<span class="go">    [-1.90368258,  0.78678454, -0.19417942,  0.17797326]])</span>
</pre></div>
</div>
<p>3.查看数据的快速统计结果:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="go">                  A         B         C         D</span>
<span class="go">    count  6.000000  6.000000  6.000000  6.000000</span>
<span class="go">    mean  -0.477614  0.037671 -0.198127  0.862672</span>
<span class="go">    std    0.945047  0.643196  0.736736  0.685969</span>
<span class="go">    min   -1.903683 -0.545903 -1.376442  0.177973</span>
<span class="go">    25%   -0.871078 -0.462082 -0.551460  0.252739</span>
<span class="go">    50%   -0.509775 -0.203747 -0.090866  0.809282</span>
<span class="go">    75%    0.014637  0.587258  0.306658  1.415466</span>
<span class="go">    max    0.859619  0.876693  0.635237  1.694740</span>
</pre></div>
</div>
<p>4.对数据进行行列转换:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">T</span>
<span class="go">       2013-01-01  2013-01-02  2013-01-03  2013-01-04  2013-01-05  2013-01-06</span>
<span class="go">    A    0.859619    0.119622   -0.719234   -0.921692   -0.300317   -1.903683</span>
<span class="go">    B   -0.545903   -0.484051   -0.396174    0.876693   -0.011320    0.786785</span>
<span class="go">    C    0.012447    0.404728    0.635237   -0.670553   -1.376442   -0.194179</span>
<span class="go">    D    1.257684    0.360880    0.216691    1.468060    1.694740    0.177973</span>
</pre></div>
</div>
<p>5.按 <a class="reference external" href="http://stackoverflow.com/questions/22149584/what-does-axis-in-pandas-mean">axis</a> 排序:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">                       D         C         B         A</span>
<span class="go">    2013-01-01  1.257684  0.012447 -0.545903  0.859619</span>
<span class="go">    2013-01-02  0.360880  0.404728 -0.484051  0.119622</span>
<span class="go">    2013-01-03  0.216691  0.635237 -0.396174 -0.719234</span>
<span class="go">    2013-01-04  1.468060 -0.670553  0.876693 -0.921692</span>
<span class="go">    2013-01-05  1.694740 -1.376442 -0.011320 -0.300317</span>
<span class="go">    2013-01-06  0.177973 -0.194179  0.786785 -1.903683</span>
</pre></div>
</div>
<p>6.按值排序:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-01  0.859619 -0.545903  0.012447  1.257684</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442  1.694740</span>
<span class="go">    2013-01-06 -1.903683  0.786785 -0.194179  0.177973</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  1.468060</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id32"><span class="section-number">14.5. </span>选择数据</a><a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">注意</span></code>:虽然标准的Python/Numpy表达式是直观且可用的，但是我们推荐使用优化后的pandas方法,例如:.at,.iat,.loc,.iloc以及.ix
详情请查看: <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing">Indexing and Selecting Data</a> 和 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/advanced.html#advanced">MultiIndex / Advanced Indexing</a></p>
<ul class="simple">
<li><p>获取</p></li>
</ul>
<p>1.选择一列，返回Series，相当于df.A:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="go">    2013-01-01    0.859619</span>
<span class="go">    2013-01-02    0.119622</span>
<span class="go">    2013-01-03   -0.719234</span>
<span class="go">    2013-01-04   -0.921692</span>
<span class="go">    2013-01-05   -0.300317</span>
<span class="go">    2013-01-06   -1.903683</span>
<span class="go">    Freq: D, Name: A, dtype: float64</span>
</pre></div>
</div>
<p>2.通过[]选择，即对行进行切片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-01  0.859619 -0.545903  0.012447  1.257684</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691</span>
</pre></div>
</div>
<ul class="simple">
<li><p>标签式选择</p></li>
</ul>
<p>1.通过标签获取交叉区域:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">    A    0.859619</span>
<span class="go">    B   -0.545903</span>
<span class="go">    C    0.012447</span>
<span class="go">    D    1.257684</span>
<span class="go">    Name: 2013-01-01 00:00:00, dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:即获取时间为2013-01-01的数据</p>
<p>2.通过标签获取多轴数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">                      A         B</span>
<span class="go">    2013-01-01  0.859619 -0.545903</span>
<span class="go">    2013-01-02  0.119622 -0.484051</span>
<span class="go">    2013-01-03 -0.719234 -0.396174</span>
<span class="go">    2013-01-04 -0.921692  0.876693</span>
<span class="go">    2013-01-05 -0.300317 -0.011320</span>
<span class="go">    2013-01-06 -1.903683  0.786785</span>
</pre></div>
</div>
<p>3.标签切片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20130102&#39;</span><span class="p">:</span><span class="s1">&#39;20130104&#39;</span><span class="p">,[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">                       A         B</span>
<span class="go">    2013-01-02  0.119622 -0.484051</span>
<span class="go">    2013-01-03 -0.719234 -0.396174</span>
<span class="go">    2013-01-04 -0.921692  0.876693</span>
</pre></div>
</div>
<p>4.对返回的对象缩减维度:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20130102&#39;</span><span class="p">,[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span>
<span class="go">    A    0.119622</span>
<span class="go">    B   -0.484051</span>
<span class="go">    Name: 2013-01-02 00:00:00, dtype: float64</span>
</pre></div>
</div>
<p>5.获取单个值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="go">    0.85961861159875042</span>
</pre></div>
</div>
<p>6.快速访问单个标量（同5）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="go">    0.85961861159875042</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:loc通过行标签获取行数据，iloc通过行号获取行数据</p>
<ul class="simple">
<li><p>位置式选择</p></li>
</ul>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-integer">通过位置选择</a></p>
<p>1.通过数值选择:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="go">    A   -0.921692</span>
<span class="go">    B    0.876693</span>
<span class="go">    C   -0.670553</span>
<span class="go">    D    1.468060</span>
<span class="go">    Name: 2013-01-04 00:00:00, dtype: float64</span>
</pre></div>
</div>
<p>2.通过数值切片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">                       A         B</span>
<span class="go">    2013-01-04 -0.921692  0.876693</span>
<span class="go">    2013-01-05 -0.300317 -0.011320</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:左开右闭</p>
<p>3.通过指定列表位置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="go">                       A         C</span>
<span class="go">    2013-01-02  0.119622  0.404728</span>
<span class="go">    2013-01-03 -0.719234  0.635237</span>
<span class="go">    2013-01-05 -0.300317 -1.376442</span>
</pre></div>
</div>
<p>4.对行切片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:]</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691</span>
</pre></div>
</div>
<p>5.对列切片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">                       B         C</span>
<span class="go">    2013-01-01 -0.545903  0.012447</span>
<span class="go">    2013-01-02 -0.484051  0.404728</span>
<span class="go">    2013-01-03 -0.396174  0.635237</span>
<span class="go">    2013-01-04  0.876693 -0.670553</span>
<span class="go">    2013-01-05 -0.011320 -1.376442</span>
<span class="go">    2013-01-06  0.786785 -0.194179</span>
</pre></div>
</div>
<p>6.获取特定值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="go">    -0.48405080229207309</span>
</pre></div>
</div>
<p>7.快速访问某个标量（同6）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="go">    -0.48405080229207309</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Boolean索引</p></li>
</ul>
<p>1.通过某列选择数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-01  0.859619 -0.545903  0.012447  1.257684</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880</span>
</pre></div>
</div>
<p>2.通过where选择数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="go">                       A         B         C         D</span>
<span class="go">    2013-01-01  0.859619       NaN  0.012447  1.257684</span>
<span class="go">    2013-01-02  0.119622       NaN  0.404728  0.360880</span>
<span class="go">    2013-01-03       NaN       NaN  0.635237  0.216691</span>
<span class="go">    2013-01-04       NaN  0.876693       NaN  1.468060</span>
<span class="go">    2013-01-05       NaN       NaN       NaN  1.694740</span>
<span class="go">    2013-01-06       NaN  0.786785       NaN  0.177973</span>
</pre></div>
</div>
<p>3.通过 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.isin.html#pandas.Series.isin">isin()</a> 过滤数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">,</span><span class="s1">&#39;four&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span>
<span class="go">                       A         B         C         D      E</span>
<span class="go">    2013-01-01  0.859619 -0.545903  0.012447  1.257684    one</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  0.360880    one</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691    two</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  1.468060  three</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442  1.694740   four</span>
<span class="go">    2013-01-06 -1.903683  0.786785 -0.194179  0.177973  three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;four&#39;</span><span class="p">])]</span>
<span class="go">                       A         B         C         D     E</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  0.216691   two</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442  1.694740  four</span>
</pre></div>
</div>
<ul class="simple">
<li><p>设置</p></li>
</ul>
<p>1.新增一列数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130102&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span>
<span class="go">    2013-01-02    1</span>
<span class="go">    2013-01-03    2</span>
<span class="go">    2013-01-04    3</span>
<span class="go">    2013-01-05    4</span>
<span class="go">    2013-01-06    5</span>
<span class="go">    2013-01-07    6</span>
<span class="go">    Freq: D, dtype: int64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s1</span>
</pre></div>
</div>
<p>2.通过标签更新值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>3.通过位置更新值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>4.通过数组更新一列值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
<p>上面几步操作的结果:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                       A         B         C  D   F</span>
<span class="go">    2013-01-01  0.000000  0.000000  0.012447  5 NaN</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  5   1</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  5   2</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  5   3</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442  5   4</span>
<span class="go">    2013-01-06 -1.903683  0.786785 -0.194179  5   5</span>
</pre></div>
</div>
<p>5.通过where更新值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span><span class="p">[</span><span class="n">df2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">df2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span>
<span class="go">                       A         B         C  D   F</span>
<span class="go">    2013-01-01  0.000000  0.000000 -0.012447 -5 NaN</span>
<span class="go">    2013-01-02 -0.119622 -0.484051 -0.404728 -5  -1</span>
<span class="go">    2013-01-03 -0.719234 -0.396174 -0.635237 -5  -2</span>
<span class="go">    2013-01-04 -0.921692 -0.876693 -0.670553 -5  -3</span>
<span class="go">    2013-01-05 -0.300317 -0.011320 -1.376442 -5  -4</span>
<span class="go">    2013-01-06 -1.903683 -0.786785 -0.194179 -5  -5</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id33"><span class="section-number">14.6. </span>缺失数据处理</a><a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>pandas用np.nan代表缺失数据，详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/missing_data.html#missing-data">Missing Data section</a></p>
<p>1.reindex()可以修改/增加/删除索引，会返回一个数据的副本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span>
<span class="go">                       A         B         C  D   F   E</span>
<span class="go">    2013-01-01  0.000000  0.000000  0.012447  5 NaN   1</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  5   1   1</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  5   2 NaN</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  5   3 NaN</span>
</pre></div>
</div>
<p>2.丢掉含有缺失项的行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="go">                       A         B         C  D  F  E</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  5  1  1</span>
</pre></div>
</div>
<p>3.对缺失项赋值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df1</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">                       A         B         C  D  F  E</span>
<span class="go">    2013-01-01  0.000000  0.000000  0.012447  5  5  1</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.404728  5  1  1</span>
<span class="go">    2013-01-03 -0.719234 -0.396174  0.635237  5  2  5</span>
<span class="go">    2013-01-04 -0.921692  0.876693 -0.670553  5  3  5</span>
</pre></div>
</div>
<p>4.对缺失项布尔赋值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="go">                    A      B      C      D      F      E</span>
<span class="go">    2013-01-01  False  False  False  False   True  False</span>
<span class="go">    2013-01-02  False  False  False  False  False  False</span>
<span class="go">    2013-01-03  False  False  False  False  False   True</span>
<span class="go">    2013-01-04  False  False  False  False  False   True</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2><a class="toc-backref" href="#id34"><span class="section-number">14.7. </span>相关操作</a><a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/basics.html#basics-binop">Basic section on Binary Ops</a></p>
<ul class="simple">
<li><p>统计(操作通常情况下不包含缺失项)</p></li>
</ul>
<p>1.按列求平均值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="go">    A   -0.620884</span>
<span class="go">    B    0.128655</span>
<span class="go">    C   -0.198127</span>
<span class="go">    D    5.000000</span>
<span class="go">    F    3.000000</span>
<span class="go">    dtype: float64</span>
</pre></div>
</div>
<p>2.按行求平均值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">    2013-01-01    1.253112</span>
<span class="go">    2013-01-02    1.208060</span>
<span class="go">    2013-01-03    1.303966</span>
<span class="go">    2013-01-04    1.456889</span>
<span class="go">    2013-01-05    1.462384</span>
<span class="go">    2013-01-06    1.737785</span>
<span class="go">    Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>3.操作不同的维度需要先对齐,pandas会沿着指定维度执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">    2013-01-01   NaN</span>
<span class="go">    2013-01-02   NaN</span>
<span class="go">    2013-01-03     1</span>
<span class="go">    2013-01-04     3</span>
<span class="go">    2013-01-05     5</span>
<span class="go">    2013-01-06   NaN</span>
<span class="go">    Freq: D, dtype: float64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="go">                       A         B         C   D   F</span>
<span class="go">    2013-01-01       NaN       NaN       NaN NaN NaN</span>
<span class="go">    2013-01-02       NaN       NaN       NaN NaN NaN</span>
<span class="go">    2013-01-03 -1.719234 -1.396174 -0.364763   4   1</span>
<span class="go">    2013-01-04 -3.921692 -2.123307 -3.670553   2   0</span>
<span class="go">    2013-01-05 -5.300317 -5.011320 -6.376442   0  -1</span>
<span class="go">    2013-01-06       NaN       NaN       NaN NaN NaN</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:</p>
<ul class="simple">
<li><p>这里对齐维度指的对齐时间index</p></li>
<li><p>shift(2)指沿着时间轴将数据顺移两位</p></li>
<li><p>sub指减法，与NaN进行操作，结果也是NaN</p></li>
</ul>
<hr class="docutils" />
<ul class="simple">
<li><p>应用</p></li>
</ul>
<p>1.对数据应用function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">)</span>
<span class="go">                       A         B         C   D   F</span>
<span class="go">    2013-01-01  0.000000  0.000000  0.012447   5 NaN</span>
<span class="go">    2013-01-02  0.119622 -0.484051  0.417175  10   1</span>
<span class="go">    2013-01-03 -0.599612 -0.880225  1.052412  15   3</span>
<span class="go">    2013-01-04 -1.521304 -0.003532  0.381859  20   6</span>
<span class="go">    2013-01-05 -1.821621 -0.014853 -0.994583  25  10</span>
<span class="go">    2013-01-06 -3.725304  0.771932 -1.188763  30  15</span>
<span class="go">    &gt;&gt;&gt; df.apply(lambda x: x.max() - x.min())</span>
<span class="go">    A    2.023304</span>
<span class="go">    B    1.360744</span>
<span class="go">    C    2.011679</span>
<span class="go">    D    0.000000</span>
<span class="go">    F    4.000000</span>
<span class="go">    dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:
- cumsum 累加</p>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/basics.html#basics-discretization">直方图和离散化</a></p>
<ul>
<li><p>直方图:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">    0    1</span>
<span class="go">    1    3</span>
<span class="go">    2    5</span>
<span class="go">    3    1</span>
<span class="go">    4    6</span>
<span class="go">    5    1</span>
<span class="go">    6    3</span>
<span class="go">    7    4</span>
<span class="go">    8    0</span>
<span class="go">    9    3</span>
<span class="go">    dtype: int64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="go">    3    3</span>
<span class="go">    1    3</span>
<span class="go">    6    1</span>
<span class="go">    5    1</span>
<span class="go">    4    1</span>
<span class="go">    0    1</span>
<span class="go">    dtype: int64</span>
</pre></div>
</div>
</li>
</ul>
<p>pandas默认配置了一些字符串处理方法，可以方便的操作元素，如下所示:(详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/text.html#text-string-methods">Vectorized String Methods</a>)</p>
<ul>
<li><p>字符串方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;Aaba&#39;</span><span class="p">,</span> <span class="s1">&#39;Baca&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;CABA&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="go">    0       a</span>
<span class="go">    1       b</span>
<span class="go">    2       c</span>
<span class="go">    3    aaba</span>
<span class="go">    4    baca</span>
<span class="go">    5     NaN</span>
<span class="go">    6    caba</span>
<span class="go">    7     dog</span>
<span class="go">    8     cat</span>
<span class="go">    dtype: object</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id14">
<h2><a class="toc-backref" href="#id35"><span class="section-number">14.8. </span>合并</a><a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>连接</p></li>
</ul>
<p>pandas提供了大量的方法，能轻松的对Series，DataFrame和Panel执行合并操作。详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/merging.html#merging">Merging section</a></p>
<p>使用concat()连接pandas对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">          0         1         2         3</span>
<span class="go">    0 -0.199614  1.914485  0.396383 -0.295306</span>
<span class="go">    1 -0.061961 -1.352883  0.266751 -0.874132</span>
<span class="go">    2  0.346504 -2.328099 -1.492250  0.095392</span>
<span class="go">    3  0.187115  0.562740 -1.677737 -0.224807</span>
<span class="go">    4 -1.422599 -1.028044  0.789487  0.806940</span>
<span class="go">    5  0.439478 -0.592229  0.736081  1.008404</span>
<span class="go">    6 -0.205641 -0.649465 -0.706395  0.578698</span>
<span class="go">    7 -2.168725 -2.487189  0.060258  1.965318</span>
<span class="go">    8  0.207634  0.512572  0.595373  0.816516</span>
<span class="go">    9  0.764893  0.612208 -1.022504 -2.032126</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pieces</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
<span class="go">          0         1         2         3</span>
<span class="go">    0 -0.199614  1.914485  0.396383 -0.295306</span>
<span class="go">    1 -0.061961 -1.352883  0.266751 -0.874132</span>
<span class="go">    2  0.346504 -2.328099 -1.492250  0.095392</span>
<span class="go">    3  0.187115  0.562740 -1.677737 -0.224807</span>
<span class="go">    4 -1.422599 -1.028044  0.789487  0.806940</span>
<span class="go">    5  0.439478 -0.592229  0.736081  1.008404</span>
<span class="go">    6 -0.205641 -0.649465 -0.706395  0.578698</span>
<span class="go">    7 -2.168725 -2.487189  0.060258  1.965318</span>
<span class="go">    8  0.207634  0.512572  0.595373  0.816516</span>
<span class="go">    9  0.764893  0.612208 -1.022504 -2.032126</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Join</p></li>
</ul>
<p>类似SQL的合并操作，详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/merging.html#merging-join">Database style joining</a></p>
<p>栗子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span> <span class="s1">&#39;lval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span> <span class="s1">&#39;rval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">left</span>
<span class="go">    key  lval</span>
<span class="go">    0  foo     1</span>
<span class="go">    1  foo     2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">right</span>
<span class="go">       key  rval</span>
<span class="go">    0  foo     4</span>
<span class="go">    1  foo     5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="go">       key  lval  rval</span>
<span class="go">    0  foo     1     4</span>
<span class="go">    1  foo     1     5</span>
<span class="go">    2  foo     2     4</span>
<span class="go">    3  foo     2     5</span>
</pre></div>
</div>
<p>栗子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="s1">&#39;lval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="s1">&#39;rval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">left</span>
<span class="go">    key  lval</span>
<span class="go">    0  foo     1</span>
<span class="go">    1  bar     2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">right</span>
<span class="go">       key  rval</span>
<span class="go">    0  foo     4</span>
<span class="go">    1  bar     5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="go">       key  lval  rval</span>
<span class="go">    0  foo     1     4</span>
<span class="go">    1  bar     2     5</span>
</pre></div>
</div>
<ul>
<li><p>追加，详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/merging.html#merging-concatenation">Appending</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">          A         B         C         D</span>
<span class="go">    0 -1.710447  2.541720 -0.654403  0.132077</span>
<span class="go">    1  0.667796 -1.124769 -0.430752 -0.244731</span>
<span class="go">    2  1.555865 -0.483805  0.066114 -0.409518</span>
<span class="go">    3  1.171798  0.036219 -0.515065  0.860625</span>
<span class="go">    4 -0.834051 -2.178128 -0.345627  0.819392</span>
<span class="go">    5 -0.354886  0.161204  1.465532  1.879841</span>
<span class="go">    6  0.560888  1.208905  1.301983  0.799084</span>
<span class="go">    7 -0.770196  0.307691  1.212200  0.909137</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">          A         B         C         D</span>
<span class="go">    0 -1.710447  2.541720 -0.654403  0.132077</span>
<span class="go">    1  0.667796 -1.124769 -0.430752 -0.244731</span>
<span class="go">    2  1.555865 -0.483805  0.066114 -0.409518</span>
<span class="go">    3  1.171798  0.036219 -0.515065  0.860625</span>
<span class="go">    4 -0.834051 -2.178128 -0.345627  0.819392</span>
<span class="go">    5 -0.354886  0.161204  1.465532  1.879841</span>
<span class="go">    6  0.560888  1.208905  1.301983  0.799084</span>
<span class="go">    7 -0.770196  0.307691  1.212200  0.909137</span>
<span class="go">    8  1.171798  0.036219 -0.515065  0.860625</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id15">
<h2><a class="toc-backref" href="#id36"><span class="section-number">14.9. </span>分组</a><a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code>:
- Splitting 将数据分组
- Applying 对每个分组应用不同的function
- Combining 使用某种数据结果展示结果
详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/groupby.html#groupby">Grouping section</a></p>
<p>举个栗子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span>
<span class="go">                       &#39;B&#39; : [&#39;one&#39;, &#39;one&#39;, &#39;two&#39;, &#39;three&#39;,&#39;two&#39;, &#39;two&#39;, &#39;one&#39;, &#39;three&#39;],</span>
<span class="go">                       &#39;C&#39; : np.random.randn(8),</span>
<span class="go">                       &#39;D&#39; : np.random.randn(8)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">         A      B         C         D</span>
<span class="go">    0  foo    one -0.655020 -0.671592</span>
<span class="go">    1  bar    one  0.846428  1.884603</span>
<span class="go">    2  foo    two -2.280466  0.725070</span>
<span class="go">    3  bar  three  1.166448 -0.208171</span>
<span class="go">    4  foo    two -0.257124 -0.850319</span>
<span class="go">    5  bar    two -0.654609  1.258091</span>
<span class="go">    6  foo    one -1.624213 -0.383978</span>
<span class="go">    7  foo  three -0.523944  0.114338</span>
</pre></div>
</div>
<p>分组后sum求和:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">                C         D</span>
<span class="go">    A</span>
<span class="go">    bar  1.358267  2.934523</span>
<span class="go">    foo -5.340766 -1.066481</span>
</pre></div>
</div>
<p>对多列分组后sum:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">                      C         D</span>
<span class="go">    A   B</span>
<span class="go">    bar one    0.846428  1.884603</span>
<span class="go">        three  1.166448 -0.208171</span>
<span class="go">        two   -0.654609  1.258091</span>
<span class="go">    foo one   -2.279233 -1.055570</span>
<span class="go">        three -0.523944  0.114338</span>
<span class="go">        two   -2.537589 -0.125249</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h2><a class="toc-backref" href="#id37"><span class="section-number">14.10. </span>重塑</a><a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h2>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/advanced.html#advanced-hierarchical">Hierarchical Indexing</a> 和 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/reshaping.html#reshaping-stacking">Reshaping</a></p>
<p><code class="docutils literal notranslate"><span class="pre">stack</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tuples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span>
<span class="go">                         &#39;foo&#39;, &#39;foo&#39;, &#39;qux&#39;, &#39;qux&#39;],</span>
<span class="go">                        [&#39;one&#39;, &#39;two&#39;, &#39;one&#39;, &#39;two&#39;,</span>
<span class="go">                         &#39;one&#39;, &#39;two&#39;, &#39;one&#39;, &#39;two&#39;]]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tuples</span>
<span class="go">    [(&#39;bar&#39;, &#39;one&#39;), (&#39;bar&#39;, &#39;two&#39;),</span>
<span class="go">     (&#39;baz&#39;, &#39;one&#39;), (&#39;baz&#39;, &#39;two&#39;),</span>
<span class="go">     (&#39;foo&#39;, &#39;one&#39;), (&#39;foo&#39;, &#39;two&#39;),</span>
<span class="go">     (&#39;qux&#39;, &#39;one&#39;), (&#39;qux&#39;, &#39;two&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span>
<span class="go">    MultiIndex(levels=[[u&#39;bar&#39;, u&#39;baz&#39;, u&#39;foo&#39;, u&#39;qux&#39;], [u&#39;one&#39;, u&#39;two&#39;]],</span>
<span class="go">               labels=[[0, 0, 1, 1, 2, 2, 3, 3], [0, 1, 0, 1, 0, 1, 0, 1]],</span>
<span class="go">               names=[u&#39;first&#39;, u&#39;second&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                         A         B</span>
<span class="go">    first second</span>
<span class="go">    bar   one    -0.922059 -0.918091</span>
<span class="go">          two    -0.825565 -0.880527</span>
<span class="go">    baz   one     0.241927  1.130320</span>
<span class="go">          two    -0.261823  2.463877</span>
<span class="go">    foo   one    -0.220328 -0.519477</span>
<span class="go">          two    -1.028038 -0.543191</span>
<span class="go">    qux   one     0.315674  0.558686</span>
<span class="go">          two     0.422296  0.241212</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df2</span>
<span class="go">                             A         B</span>
<span class="go">    first second</span>
<span class="go">    bar   one    -0.922059 -0.918091</span>
<span class="go">          two    -0.825565 -0.880527</span>
<span class="go">    baz   one     0.241927  1.130320</span>
<span class="go">          two    -0.261823  2.463877</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:pd.MultiIndex.from_tuples 将包含多个list的元组转换为复杂索引</p>
<p>使用stack()方法为DataFrame增加column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stacked</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stacked</span>
<span class="go">    first  second</span>
<span class="go">    bar    one     A   -0.922059</span>
<span class="go">                   B   -0.918091</span>
<span class="go">           two     A   -0.825565</span>
<span class="go">                   B   -0.880527</span>
<span class="go">    baz    one     A    0.241927</span>
<span class="go">                   B    1.130320</span>
<span class="go">           two     A   -0.261823</span>
<span class="go">                   B    2.463877</span>
<span class="go">    dtype: float64</span>
</pre></div>
</div>
<p>使用unstack()方法还原stack的DataFrame，默认还原最后一级，也可以自由指定:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="go">                     A         B</span>
<span class="go">    first second</span>
<span class="go">    bar   one    -0.922059 -0.918091</span>
<span class="go">          two    -0.825565 -0.880527</span>
<span class="go">    baz   one     0.241927  1.130320</span>
<span class="go">          two    -0.261823  2.463877</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">    second        one       two</span>
<span class="go">    first</span>
<span class="go">    bar   A -0.922059 -0.825565</span>
<span class="go">          B -0.918091 -0.880527</span>
<span class="go">    baz   A  0.241927 -0.261823</span>
<span class="go">          B  1.130320  2.463877</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">    first          bar       baz</span>
<span class="go">    second</span>
<span class="go">    one    A -0.922059  0.241927</span>
<span class="go">           B -0.918091  1.130320</span>
<span class="go">    two    A -0.825565 -0.261823</span>
<span class="go">           B -0.880527  2.463877</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">透视表</span></code>
详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/reshaping.html#reshaping-pivot">Pivot Tables</a></p>
<p>栗子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
<span class="go">                       &#39;B&#39; : [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;] * 4,</span>
<span class="go">                       &#39;C&#39; : [&#39;foo&#39;, &#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;bar&#39;, &#39;bar&#39;] * 2,</span>
<span class="go">                       &#39;D&#39; : np.random.randn(12),</span>
<span class="go">                       &#39;E&#39; : np.random.randn(12)})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:可以理解为自由组合表的行与列，类似于交叉报表</p>
<p>我们能非常简单的构造透视表:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
<span class="go">    C             bar       foo</span>
<span class="go">    A     B</span>
<span class="go">    one   A -1.250611 -1.047274</span>
<span class="go">          B  1.532134 -0.455948</span>
<span class="go">          C  0.125989 -0.500260</span>
<span class="go">    three A  0.623716       NaN</span>
<span class="go">          B       NaN  0.095117</span>
<span class="go">          C -0.348707       NaN</span>
<span class="go">    two   A       NaN  0.390363</span>
<span class="go">          B -0.743466       NaN</span>
<span class="go">          C       NaN  0.792279</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h2><a class="toc-backref" href="#id38"><span class="section-number">14.11. </span>时间序列</a><a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<p>pandas可以简单高效的进行重新采样通过频率转换(例如:将秒级数据转换成五分钟为单位的数据)。这常见与金融应用中，但是不限于此。详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#timeseries">Time Series section</a></p>
<p>栗子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">    2012-01-01    24390</span>
<span class="go">    Freq: 5T, dtype: int64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:将随机产生的秒级数据整合成5min的数据</p>
<p>时区表现:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">rng</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span>
<span class="go">    2012-03-06    0.972202</span>
<span class="go">    2012-03-07   -0.839969</span>
<span class="go">    2012-03-08   -0.979993</span>
<span class="go">    2012-03-09   -0.052460</span>
<span class="go">    2012-03-10   -0.487963</span>
<span class="go">    Freq: D, dtype: float64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts_utc</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts_utc</span>
<span class="go">    2012-03-06 00:00:00+00:00    0.972202</span>
<span class="go">    2012-03-07 00:00:00+00:00   -0.839969</span>
<span class="go">    2012-03-08 00:00:00+00:00   -0.979993</span>
<span class="go">    2012-03-09 00:00:00+00:00   -0.052460</span>
<span class="go">    2012-03-10 00:00:00+00:00   -0.487963</span>
<span class="go">    Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>时区变换:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
<span class="go">    2012-03-05 19:00:00-05:00    0.972202</span>
<span class="go">    2012-03-06 19:00:00-05:00   -0.839969</span>
<span class="go">    2012-03-07 19:00:00-05:00   -0.979993</span>
<span class="go">    2012-03-08 19:00:00-05:00   -0.052460</span>
<span class="go">    2012-03-09 19:00:00-05:00   -0.487963</span>
<span class="go">    Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>在不同的时间跨度表现间变换:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span>
<span class="go">    2012-01-31   -0.681068</span>
<span class="go">    2012-02-29   -0.263571</span>
<span class="go">    2012-03-31    1.268001</span>
<span class="go">    2012-04-30    0.331786</span>
<span class="go">    2012-05-31    0.663572</span>
<span class="go">    Freq: M, dtype: float64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">to_period</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span>
<span class="go">    2012-01   -0.681068</span>
<span class="go">    2012-02   -0.263571</span>
<span class="go">    2012-03    1.268001</span>
<span class="go">    2012-04    0.331786</span>
<span class="go">    2012-05    0.663572</span>
<span class="go">    Freq: M, dtype: float64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="go">    2012-01-01   -0.681068</span>
<span class="go">    2012-02-01   -0.263571</span>
<span class="go">    2012-03-01    1.268001</span>
<span class="go">    2012-04-01    0.331786</span>
<span class="go">    2012-05-01    0.663572</span>
<span class="go">    Freq: MS, dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">注</span></code>:to_period()默认频率为M，to_period和to_timestamp可以相互转换</p>
<p>在周期和时间戳间转换，下面的栗子将季度时间转换为各季度最后一个月的09am:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1990Q1&#39;</span><span class="p">,</span> <span class="s1">&#39;2000Q4&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q-NOV&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prng</span>
<span class="go">    PeriodIndex([&#39;1990Q1&#39;, &#39;1990Q2&#39;, &#39;1990Q3&#39;, &#39;1990Q4&#39;, &#39;1991Q1&#39;, &#39;1991Q2&#39;,</span>
<span class="go">                 &#39;1991Q3&#39;, &#39;1991Q4&#39;, &#39;1992Q1&#39;, &#39;1992Q2&#39;, &#39;1992Q3&#39;, &#39;1992Q4&#39;,</span>
<span class="go">                 &#39;1993Q1&#39;, &#39;1993Q2&#39;, &#39;1993Q3&#39;, &#39;1993Q4&#39;, &#39;1994Q1&#39;, &#39;1994Q2&#39;,</span>
<span class="go">                 &#39;1994Q3&#39;, &#39;1994Q4&#39;, &#39;1995Q1&#39;, &#39;1995Q2&#39;, &#39;1995Q3&#39;, &#39;1995Q4&#39;,</span>
<span class="go">                 &#39;1996Q1&#39;, &#39;1996Q2&#39;, &#39;1996Q3&#39;, &#39;1996Q4&#39;, &#39;1997Q1&#39;, &#39;1997Q2&#39;,</span>
<span class="go">                 &#39;1997Q3&#39;, &#39;1997Q4&#39;, &#39;1998Q1&#39;, &#39;1998Q2&#39;, &#39;1998Q3&#39;, &#39;1998Q4&#39;,</span>
<span class="go">                 &#39;1999Q1&#39;, &#39;1999Q2&#39;, &#39;1999Q3&#39;, &#39;1999Q4&#39;, &#39;2000Q1&#39;, &#39;2000Q2&#39;,</span>
<span class="go">                 &#39;2000Q3&#39;, &#39;2000Q4&#39;],</span>
<span class="go">                dtype=&#39;int64&#39;, freq=&#39;Q-NOV&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prng</span><span class="p">)),</span> <span class="n">prng</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">prng</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">    1990-03-01 09:00   -0.927090</span>
<span class="go">    1990-06-01 09:00   -1.045881</span>
<span class="go">    1990-09-01 09:00   -0.837705</span>
<span class="go">    1990-12-01 09:00   -0.529390</span>
<span class="go">    1991-03-01 09:00   -0.423405</span>
<span class="go">    Freq: H, dtype: float64</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id39"><span class="section-number">14.12. </span>分类</a><a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<p>从0.15版以后，pandas可以造DataFrame中包含分类数据，详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/categorical.html#categorical">分类介绍</a> 和 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/api.html#api-categorical">API 文档</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="s2">&quot;raw_grade&quot;</span><span class="p">:[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]})</span>
</pre></div>
</div>
<p>1.将原始成绩转换为分类数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;raw_grade&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span>
<span class="go">    0    a</span>
<span class="go">    1    b</span>
<span class="go">    2    b</span>
<span class="go">    3    a</span>
<span class="go">    4    a</span>
<span class="go">    5    e</span>
<span class="go">    Name: grade, dtype: category</span>
<span class="go">    Categories (3, object): [a, b, e]</span>
</pre></div>
</div>
<p>2.重命名分类使其更有意义:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;very good&quot;</span><span class="p">,</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span> <span class="s2">&quot;very bad&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>3.重新整理类别，并添加缺少的类别:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">set_categories</span><span class="p">([</span><span class="s2">&quot;very bad&quot;</span><span class="p">,</span> <span class="s2">&quot;bad&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span> <span class="s2">&quot;very good&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span>
<span class="go">    0    very good</span>
<span class="go">    1         good</span>
<span class="go">    2         good</span>
<span class="go">    3    very good</span>
<span class="go">    4    very good</span>
<span class="go">    5     very bad</span>
<span class="go">    Name: grade, dtype: category</span>
<span class="go">    Categories (5, object): [very bad, bad, medium, good, very good]</span>
</pre></div>
</div>
<p>4.按整理后的类别排序(并非词汇的顺序):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;grade&quot;</span><span class="p">)</span>
<span class="go">       id raw_grade      grade</span>
<span class="go">    5   6         e   very bad</span>
<span class="go">    1   2         b       good</span>
<span class="go">    2   3         b       good</span>
<span class="go">    0   1         a  very good</span>
<span class="go">    3   4         a  very good</span>
<span class="go">    4   5         a  very good</span>
</pre></div>
</div>
<p>5.按类别分组也包括空类别:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;grade&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="go">    grade</span>
<span class="go">    very bad     1</span>
<span class="go">    bad          0</span>
<span class="go">    medium       0</span>
<span class="go">    good         2</span>
<span class="go">    very good    3</span>
<span class="go">    dtype: int64</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h2><a class="toc-backref" href="#id40"><span class="section-number">14.13. </span>绘图</a><a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h2>
<p>详情请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/visualization.html#visualization">Plotting</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="go">    &lt;matplotlib.axes._subplots.AxesSubplot at 0x7ff2ab2af550&gt;</span>
</pre></div>
</div>
<p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/_images/series_plot_basic.png">图一</a></p>
<p>在DataFrame中，plot()可以绘制所有带有标签的列:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="go">                      columns=[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="go">    &lt;matplotlib.legend.Legend at 0x7ff29c8163d0&gt;</span>
</pre></div>
</div>
<p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/_images/frame_plot_basic.png">图二</a></p>
</div>
<div class="section" id="id23">
<h2><a class="toc-backref" href="#id41"><span class="section-number">14.14. </span>获取数据 写入导出</a><a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>CSV</p></li>
</ul>
<ol class="arabic">
<li><p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html#io-store-in-csv">写入csv文件</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html#io-read-csv-table">读取csv文件</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;foo.csv&#39;</span><span class="p">)</span>
<span class="go">         Unnamed: 0          A          B         C          D</span>
<span class="go">    0    2000-01-01   0.266457  -0.399641 -0.219582   1.186860</span>
<span class="go">    1    2000-01-02  -1.170732  -0.345873  1.653061  -0.282953</span>
<span class="go">    2    2000-01-03  -1.734933   0.530468  2.060811  -0.515536</span>
<span class="go">    3    2000-01-04  -1.555121   1.452620  0.239859  -1.156896</span>
<span class="go">    4    2000-01-05   0.578117   0.511371  0.103552  -2.428202</span>
<span class="go">    5    2000-01-06   0.478344   0.449933 -0.741620  -1.962409</span>
<span class="go">    6    2000-01-07   1.235339  -0.091757 -1.543861  -1.084753</span>
<span class="go">    ..          ...        ...        ...       ...        ...</span>
<span class="go">    993  2002-09-20 -10.628548  -9.153563 -7.883146  28.313940</span>
<span class="go">    994  2002-09-21 -10.390377  -8.727491 -6.399645  30.914107</span>
<span class="go">    995  2002-09-22  -8.985362  -8.485624 -4.669462  31.367740</span>
<span class="go">    996  2002-09-23  -9.558560  -8.781216 -4.499815  30.518439</span>
<span class="go">    997  2002-09-24  -9.902058  -9.340490 -4.386639  30.105593</span>
<span class="go">    998  2002-09-25 -10.216020  -9.480682 -3.933802  29.758560</span>
<span class="go">    999  2002-09-26 -11.856774 -10.671012 -3.216025  29.369368</span>

<span class="go">    [1000 rows x 5 columns]</span>
</pre></div>
</div>
</li>
</ol>
<ul class="simple">
<li><p>HDF5</p></li>
</ul>
<p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html#io-hdf5">HDFStores</a></p>
<p>1.写入HDF5 Store:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s1">&#39;foo.h5&#39;</span><span class="p">,</span><span class="s1">&#39;df&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>2.从HDF5 Store读取:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;foo.h5&#39;</span><span class="p">,</span><span class="s1">&#39;df&#39;</span><span class="p">)</span>
<span class="go">                        A          B         C          D</span>
<span class="go">    2000-01-01   0.266457  -0.399641 -0.219582   1.186860</span>
<span class="go">    2000-01-02  -1.170732  -0.345873  1.653061  -0.282953</span>
<span class="go">    2000-01-03  -1.734933   0.530468  2.060811  -0.515536</span>
<span class="go">    2000-01-04  -1.555121   1.452620  0.239859  -1.156896</span>
<span class="go">    2000-01-05   0.578117   0.511371  0.103552  -2.428202</span>
<span class="go">    2000-01-06   0.478344   0.449933 -0.741620  -1.962409</span>
<span class="go">    2000-01-07   1.235339  -0.091757 -1.543861  -1.084753</span>
<span class="go">    ...               ...        ...       ...        ...</span>
<span class="go">    2002-09-20 -10.628548  -9.153563 -7.883146  28.313940</span>
<span class="go">    2002-09-21 -10.390377  -8.727491 -6.399645  30.914107</span>
<span class="go">    2002-09-22  -8.985362  -8.485624 -4.669462  31.367740</span>
<span class="go">    2002-09-23  -9.558560  -8.781216 -4.499815  30.518439</span>
<span class="go">    2002-09-24  -9.902058  -9.340490 -4.386639  30.105593</span>
<span class="go">    2002-09-25 -10.216020  -9.480682 -3.933802  29.758560</span>
<span class="go">    2002-09-26 -11.856774 -10.671012 -3.216025  29.369368</span>

<span class="go">    [1000 rows x 4 columns]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Excel</p></li>
</ul>
<p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html#io-excel">MS Excel</a></p>
<p>1.写入excel文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;foo.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>2.从excel文件读取:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;foo.xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">])</span>
<span class="go">                        A          B         C          D</span>
<span class="go">    2000-01-01   0.266457  -0.399641 -0.219582   1.186860</span>
<span class="go">    2000-01-02  -1.170732  -0.345873  1.653061  -0.282953</span>
<span class="go">    2000-01-03  -1.734933   0.530468  2.060811  -0.515536</span>
<span class="go">    2000-01-04  -1.555121   1.452620  0.239859  -1.156896</span>
<span class="go">    2000-01-05   0.578117   0.511371  0.103552  -2.428202</span>
<span class="go">    2000-01-06   0.478344   0.449933 -0.741620  -1.962409</span>
<span class="go">    2000-01-07   1.235339  -0.091757 -1.543861  -1.084753</span>
<span class="go">    ...               ...        ...       ...        ...</span>
<span class="go">    2002-09-20 -10.628548  -9.153563 -7.883146  28.313940</span>
<span class="go">    2002-09-21 -10.390377  -8.727491 -6.399645  30.914107</span>
<span class="go">    2002-09-22  -8.985362  -8.485624 -4.669462  31.367740</span>
<span class="go">    2002-09-23  -9.558560  -8.781216 -4.499815  30.518439</span>
<span class="go">    2002-09-24  -9.902058  -9.340490 -4.386639  30.105593</span>
<span class="go">    2002-09-25 -10.216020  -9.480682 -3.933802  29.758560</span>
<span class="go">    2002-09-26 -11.856774 -10.671012 -3.216025  29.369368</span>

<span class="go">    [1000 rows x 4 columns]</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h2><a class="toc-backref" href="#id42"><span class="section-number">14.15. </span>小陷阱</a><a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h2>
<p>如果你操作时遇到了如下异常:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]):</span>
<span class="go">    ...     print(&quot;I was true&quot;)</span>
<span class="go">    ...</span>
<span class="go">    Traceback (most recent call last):</span>
<span class="go">    File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">      File &quot;/usr/lib64/python2.7/site-packages/pandas/core/generic.py&quot;, line 730, in __nonzero__</span>
<span class="go">        .format(self.__class__.__name__))</span>
<span class="go">    ValueError: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().</span>
</pre></div>
</div>
<p>请查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/basics.html#basics-compare">Comparisons</a> 来处理异常
查看 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/gotchas.html#gotchas">Gotchas</a> 也可以</p>
</div>
<div class="section" id="id26">
<h2><a class="toc-backref" href="#id43"><span class="section-number">14.16. </span>pandas实战</a><a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h2>
</div>
</div>


            <div class="cut">***</div>
          </div>
       </div>
     </div>
  </div>
      <div class="clearer"></div>
    </div>
  
  <a href="http://github.com/hit9/PyZh">
    <img style="position: fixed; top: 0; right: 0; border: 0;"
    src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
    alt="Fork me on GitHub" />
  </a>
  

  
  <div class="footer">
    &copy; Copyright 2013, hit9.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>. Theme
    <a href="https://github.com/hit9/sphinx-theme-rux">rux</a>.
  </div>

  </body>
</html>