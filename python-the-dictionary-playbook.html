
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. Python:字典的剧本(翻译自Python:The Dictionary Playbook) &#8212; 一起写Python文章，一起看Python文章</title>
    <link rel="stylesheet" href="_static/rux.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="3. (译)Python关键字yield的解释(stackoverflow)" href="the-python-yield-keyword-explained.html" />
    <link rel="prev" title="1. Python描述器引导(翻译)" href="Descriptor-HOW-TO-Guide.html" />
   
  <script type="text/javascript"
    src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  </head><body>
  
  


    <div class="document">
  <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body">
          <h1 class="project-name">
            <a href="index.html">PyZh</a>
          </h1>
          <div class="nav separator">
          <span>
            <a href="index.html">Index</a>&nbsp;~ <a href="https://github.com/hit9/PyZh">Code</a>&nbsp;
            ~ <a href="https://github.com/hit9/PyZh/issues">Issues</a>&nbsp;</span>
          </div>
          <p class="flourish"><img src="_static/flourish.svg" height="60px" alt=""></p>
          <div class="body-html">
            
  <div class="section" id="python-python-the-dictionary-playbook">
<h1><a class="toc-backref" href="#id2"><span class="section-number">2. </span>Python:字典的剧本(翻译自Python:The Dictionary Playbook)</a><a class="headerlink" href="#python-python-the-dictionary-playbook" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">原文</dt>
<dd class="field-odd"><p><a class="reference external" href="http://blog.amir.rachum.com/post/39501813266/python-the-dictionary-playbook">http://blog.amir.rachum.com/post/39501813266/python-the-dictionary-playbook</a></p>
</dd>
<dt class="field-even">翻译</dt>
<dd class="field-even"><p>hit9</p>
</dd>
</dl>
<p>我经常遇到各种五花八门的关于Python中的字典的代码用法，我决定在这个文章中展示一些并分享完成同样操作的更为简洁的做法。</p>
<div class="contents topic" id="id1">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#python-python-the-dictionary-playbook" id="id2">Python:字典的剧本(翻译自Python:The Dictionary Playbook)</a></p>
<ul>
<li><p><a class="reference internal" href="#the-are-you-there" id="id3">键的存在性(The “Are You There?”)</a></p></li>
<li><p><a class="reference internal" href="#yoda-the-yoda-test" id="id4">Yoda 测试(The “Yoda Test”)</a></p></li>
<li><p><a class="reference internal" href="#the-get-the-value-anyway" id="id5">无论如何都要取到值(The “Get The Value Anyway”)</a></p></li>
<li><p><a class="reference internal" href="#the-make-it-happen" id="id6">让它发生!(The “Make it Happen”)</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-are-you-there">
<h2><a class="toc-backref" href="#id3"><span class="section-number">2.1. </span>键的存在性(The “Are You There?”)</a><a class="headerlink" href="#the-are-you-there" title="永久链接至标题">¶</a></h2>
<p>不推荐的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dct</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>Python的做法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="ow">in</span> <span class="n">dct</span>
</pre></div>
</div>
</div>
<div class="section" id="yoda-the-yoda-test">
<h2><a class="toc-backref" href="#id4"><span class="section-number">2.2. </span>Yoda 测试(The “Yoda Test”)</a><a class="headerlink" href="#yoda-the-yoda-test" title="永久链接至标题">¶</a></h2>
<p>对于那些精通 “Are Your There” 的程序员，还有一个简单的同样也很恼人的行为，不仅仅对于dict而言，它很普遍</p>
<p>如果你非要Not</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dct</span>
</pre></div>
</div>
<p>English,你会说么？:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span>
</pre></div>
</div>
</div>
<div class="section" id="the-get-the-value-anyway">
<h2><a class="toc-backref" href="#id5"><span class="section-number">2.3. </span>无论如何都要取到值(The “Get The Value Anyway”)</a><a class="headerlink" href="#the-get-the-value-anyway" title="永久链接至标题">¶</a></h2>
<p>这个是相当流行。你有一个dict和key,并且你想修改key对应的值，比如给它自增1(假如你在数数)。</p>
<p>比较逊一点的做法：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
    <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>漂亮的做法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>关于 <code class="docutils literal notranslate"><span class="pre">dct.get(key[,</span> <span class="pre">default])</span></code> ,如果 <code class="docutils literal notranslate"><span class="pre">key</span></code> 存在,返回 <code class="docutils literal notranslate"><span class="pre">dct[key]</span></code>,否则返回 <code class="docutils literal notranslate"><span class="pre">default</span></code></p>
<p>更棒的做法是:</p>
<p>如果你在使用Python 2.7,你就可以用Counter来计数了:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Counter</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">Counter({1: 5, 2: 2, 3: 1})</span>
</pre></div>
</div>
<p>这里还有些更完整的例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="gp">... </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter a number: &quot;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">counter</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">num</span><span class="p">])</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">counter</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="s2">&quot;You have entered </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> times!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="go">Enter a number: 1</span>
<span class="go">Enter a number: 1</span>
<span class="go">Enter a number: 2</span>
<span class="go">Enter a number: 3</span>
<span class="go">Enter a number: 51</span>
<span class="go">Enter a number: 1</span>
<span class="go">Enter a number: 1</span>
<span class="go">Enter a number: 1</span>
<span class="go">Enter a number: 2</span>
<span class="go">Enter a number: 3</span>
<span class="go">You have entered 1, 5 times!</span>
<span class="go">You have entered 2, 2 times!</span>
<span class="go">You have entered 3, 2 times!</span>
<span class="go">You have entered 51, 1 times!</span>
</pre></div>
</div>
</div>
<div class="section" id="the-make-it-happen">
<h2><a class="toc-backref" href="#id6"><span class="section-number">2.4. </span>让它发生!(The “Make it Happen”)</a><a class="headerlink" href="#the-make-it-happen" title="永久链接至标题">¶</a></h2>
<p>有时你的字典里都是经常修改的对象，你需要初始化一些数据到这个字典，也需要修改其中的一些值。比如说，你在维护一个这样的dict:它的值都是链表。</p>
<p>写一个实现就是:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
        <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
</pre></div>
</div>
<p>更Pythonic的做法是:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># key might exist already</span>
    <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">setdefault(key,</span> <span class="pre">default)</span></code> 所做的是：如果存在，返回 <code class="docutils literal notranslate"><span class="pre">dct[key]</span></code> , 不存在则把 <code class="docutils literal notranslate"><span class="pre">dct[key]</span></code> 设为 <code class="docutils literal notranslate"><span class="pre">default</span></code> 并返回它。当一个默认的值是一个你可以修改的对象的时候这是很有用的。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">defaultdict</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dct</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1"># all keys have a default already</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">defaultdict</span></code> 非常棒, 它每生成一对新的 <code class="docutils literal notranslate"><span class="pre">key-value</span></code> ，就会给value一个默认值, 这个默认值就是
<code class="docutils literal notranslate"><span class="pre">defaultdict</span></code> 的参数。(注:defaultdict在模块 <code class="docutils literal notranslate"><span class="pre">collections</span></code> 中)</p>
<p>一个很有意思的就是，defaultdict实现的一行的tree: <a class="reference external" href="https://gist.github.com/2012250">https://gist.github.com/2012250</a></p>
</div>
</div>


            <div class="cut">***</div>
          </div>
       </div>
     </div>
  </div>
      <div class="clearer"></div>
    </div>
  
  <a href="http://github.com/hit9/PyZh">
    <img style="position: fixed; top: 0; right: 0; border: 0;"
    src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
    alt="Fork me on GitHub" />
  </a>
  

  
  <div class="footer">
    &copy; Copyright 2013, hit9.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>. Theme
    <a href="https://github.com/hit9/sphinx-theme-rux">rux</a>.
  </div>

  </body>
</html>